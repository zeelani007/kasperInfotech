"use strict";var __decorate=this&&this.__decorate||function(e,t,r,o){var n,a=arguments.length,c=a<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(e,t,r,o);else for(var s=e.length-1;0<=s;s--)(n=e[s])&&(c=(a<3?n(c):3<a?n(t,r,c):n(t,r))||c);return 3<a&&c&&Object.defineProperty(t,r,c),c};exports.__esModule=!0;var operators_1=require("rxjs/operators"),rxjs_1=require("rxjs"),constant_1=require("./../constant/constant"),core_1=require("@angular/core"),AuthService=function(){function e(e,t){this.http=e,this._router=t,this._loginUrl=constant_1.Constant.API_ENDPOINT+"/oauth/token",this._client_id="demo-client",this._client_secret="demo-secret",this.tokenHeader={Authorization:"Basic "+btoa(this._client_id+":"+this._client_secret),"Content-Type":"application/x-www-form-urlencoded"}}return e.prototype.getFormUrlEncoded=function(e){var t=[];for(var r in e){var o=encodeURIComponent(r),n=encodeURIComponent(e[r]);t.push(o+"="+n)}return t.join("&")},e.prototype.errorHandler=function(e){return console.log("Auth Service api error ",e),rxjs_1.throwError(e)},e.prototype.loginUser=function(e){localStorage.removeItem("token"),localStorage.removeItem("access_token");var t={username:e.username,password:e.password,grant_type:"password"};return this.http.post(this._loginUrl,this.getFormUrlEncoded(t),{headers:this.tokenHeader})},e.prototype.refreshToken=function(t,r){var o=this;null!=localStorage.getItem("refreshToken")?this.callRefreshToken().subscribe(function(e){localStorage.setItem("token",e.access_token),localStorage.setItem("refreshToken",e.refresh_token),r.handle(t),location.reload()},function(e){o.logout()}):this._router.navigate(["/"])},e.prototype.callRefreshToken=function(){localStorage.removeItem("token");var e={grant_type:"refresh_token",client_id:this._client_id,client_secret:this._client_secret,refresh_token:localStorage.getItem("refreshToken")};return this.http.post(this._loginUrl,this.getFormUrlEncoded(e),{headers:this.tokenHeader}).pipe(operators_1.catchError(this.errorHandler))},e.prototype.isLoggedIn=function(){return!!localStorage.getItem("token")},e.prototype.isAdmin=function(){return"ROLE_ADMIN"===localStorage.getItem("role")},e.prototype.logout=function(){localStorage.removeItem("token"),localStorage.removeItem("refreshToken"),localStorage.removeItem("role"),localStorage.clear(),this._router.navigate(["/"])},e=__decorate([core_1.Injectable()],e)}();exports.AuthService=AuthService;
//# sourceMappingURL=auth.service.min.js.map
